<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

    <button type="button">取回数据</button>

    <input type="button" value="也取回数据">
    <script>


        function xxx() {
            return new Promise((resolve, reject) => {
                // 逻辑代码
                let x = Math.random() * 100;

                if (x > 50) {
                    resolve(x);
                } else {
                    reject(x);
                }
            })
        }

        xxx()
            .then((e) => {
                console.log(e, 'OK');
            })
            .catch((e) => {
                console.log(e, 'ERR');
            })
            .finally(() => {
                console.log('end');
            })





        function ajaxGet(url) {
            return new Promise(function (success, error) {
                let xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        success(xhr.response);
                    }
                }
                xhr.open('GET', url);
                xhr.responseType = 'json';
                xhr.send();
            })
        }

        document.querySelector('button').onclick = function () {
            // 并发的执行多个任务，当所有的任务的结果都返回后整体的到结果
            // Promise.all([ajaxGet('/xxx?hobby=打球'), ajaxGet('/yyy?age=66')])
            // .then((x)=>{
            //     console.log(x);
            // });
            // 并发的执行多个任务，只要有一个任务有结果就直接得到整体结果
            // Promise.race([ajaxGet('/xxx?hobby=打球'), ajaxGet('/yyy?age=66')])
            // .then((x)=>{
            //     console.log(x);
            // })

            // ajaxGet('/xxx?hobby=打球')
            // .then((x)=>{
            //     console.log(x);
            // })

            // ajaxGet('/yyy?age=66')
            // .then((x)=>{
            //     console.log(x);
            // })
        };


        async function sss() {
            // let x = {};
            // x = await ajaxGet('/xxx?hobby=打球');
            // console.log(x);

            // await 只能在async修饰的函数中使用
            // await 后面跟着的必须是个Promise实例
            let data = await ajaxGet('/xxx?hobby=打球');
            let xx = await ajaxGet('/yyy?age=' + data.age);
            console.log(xx);
        }

        document.querySelector('button').onclick = function () {
            // ajaxGet('/xxx?hobby=打球')
            //     .then(function (data) {
            //         return ajaxGet('/yyy?age=' + data.age);
            //     }).then(function (e) {
            //         console.log(e);
            //     })

            // sss();

            // 简单写法
            (async () => {
                let data = await ajaxGet('/xxx?hobby=打球');
                let xx = await ajaxGet('/yyy?age=' + data.age);
                console.log(xx);
            })();
        };


        // ajaxGet('/xxx?hobby=打球', function (data) {
        //     ajaxGet('/yyy?age=' + data.age, function (e) {
        //         ajaxGet('/zzz?age=' + data.age, function (e) {
        //             ajaxGet('/aaa?age=' + data.age, function (e) {
        //                 ajaxGet('/bbb?age=' + data.age, function (e) {
        //                     ajaxGet('/ccc?age=' + data.age, function (e) {

        //                     })

        //                 })

        //             })

        //         })
        //     })
        // })


        // document.querySelector('button').onclick = function () {
        //     let aaa = 1111;
        //     let bbb = 0;
        //     ajaxGet('/xxx?hobby=打球', function (data) {
        //         // console.log(data);
        //         // bbb = data.age;
        //     });
        //     console.log(aaa + bbb);
        // }


        // document.querySelector('input').onclick = function () {
        //     ajaxGet('/xxx?hobby=游泳', function(data){
        //         console.log(data);
        //     })
        // }




    </script>
</body>

</html>